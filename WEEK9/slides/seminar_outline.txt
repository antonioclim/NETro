# Seminar 9 â€“ Protocoale de FiÈ™iere: Server FTP Custom
# Outline pentru PowerPoint / reveal.js

================================================================================
SLIDE 1: Titlu
================================================================================
Titlu: Seminar 9 â€“ Protocoale de FiÈ™iere
Subtitlu: Server FTP Custom È™i Testare Multi-Client
Footer: ASE BucureÈ™ti | ReÈ›ele de Calculatoare | Revolvix&Hypotheticalandrei
Imagine: PictogramÄƒ transfer fiÈ™iere + containere Docker

================================================================================
SLIDE 2: Obiective Practice
================================================================================
Titlu: Ce vom realiza astÄƒzi

Checklist format:
â˜ ImplementÄƒm un protocol binar custom (pseudo-FTP)
â˜ TestÄƒm transferuri client-server
â˜ CapturÄƒm È™i analizÄƒm traficul cu tshark
â˜ OrchestrÄƒm multi-client cu Docker Compose
â˜ (OpÈ›ional) SimulÄƒm Ã®n Mininet

================================================================================
SLIDE 3: Materiale necesare
================================================================================
Titlu: PregÄƒtire

Ce trebuie sÄƒ aveÈ›i:
â€¢ starterkit_s9/ descÄƒrcat È™i dezarhivat
â€¢ Python 3.8+ instalat
â€¢ Docker instalat È™i funcÈ›ional
â€¢ Terminal/CLI disponibil

Verificare rapidÄƒ:
```bash
make verify
```
Toate check-urile trebuie sÄƒ fie verzi âœ“

================================================================================
SLIDE 4: Agenda
================================================================================
Titlu: Parcursul seminarului

| Timp | Activitate |
|------|-----------|
| 10 min | Setup È™i verificare mediu |
| 15 min | Demo endianness È™i framing |
| 20 min | Server + Client pseudo-FTP |
| 20 min | CapturÄƒ Wireshark |
| 20 min | Docker multi-client |
| 15 min | Debugging + Q&A |

================================================================================
SLIDE 5: Structura Protocolului
================================================================================
Titlu: Header Protocol Pseudo-FTP

DiagramÄƒ:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HEADER (16 bytes)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Magic (4B)   â”‚ Length (4B)  â”‚ CRC-32 (4B)  â”‚ Flags (4B) â”‚
â”‚ 0x46545043   â”‚ Big Endian   â”‚ Big Endian   â”‚ Bit 0:Comp â”‚
â”‚ = "FTPC"     â”‚              â”‚              â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

De ce fiecare cÃ¢mp:
â€¢ Magic: identificare rapidÄƒ protocol
â€¢ Length: È™tim cÃ¢t sÄƒ citim
â€¢ CRC-32: verificare integritate
â€¢ Flags: opÈ›iuni extensibile

================================================================================
SLIDE 6: Comenzi Suportate
================================================================================
Titlu: Protocoal pseudo-FTP â€“ Comenzi

| ComandÄƒ | SintaxÄƒ | Descriere |
|---------|---------|-----------|
| AUTH | AUTH user:pass | Autentificare |
| PWD | PWD | Director curent |
| LIST | LIST [pattern] | Listare fiÈ™iere |
| GET | GET filename | DescÄƒrcare fiÈ™ier |
| PUT | PUT filename | ÃncÄƒrcare fiÈ™ier |
| QUIT | QUIT | Ãnchidere sesiune |

================================================================================
SLIDE 7: Demo 1 â€“ Endianness
================================================================================
Titlu: Demo: ÃnÈ›elegerea Byte Order

Terminal live:
```bash
cd python/exercises
python ex_9_01_endianness.py
```

ObservÄƒm:
â€¢ 0x12345678 â†’ Big Endian: 12 34 56 78
â€¢ 0x12345678 â†’ Little Endian: 78 56 34 12
â€¢ struct.pack foloseÈ™te '>' pentru network order

================================================================================
SLIDE 8: Demo 2 â€“ Server
================================================================================
Titlu: Demo: Pornirea Serverului

Terminal 1:
```bash
cd python/demos
python ex_9_02_pseudo_ftp.py --mode server --port 9021
```

Output aÈ™teptat:
```
[INFO] Server started on 0.0.0.0:9021
[INFO] Waiting for connections...
```

âš ï¸ LÄƒsaÈ›i serverul sÄƒ ruleze!

================================================================================
SLIDE 9: Demo 3 â€“ Client
================================================================================
Titlu: Demo: Sesiune Client

Terminal 2:
```bash
python ex_9_02_pseudo_ftp.py --mode client --host localhost --port 9021
```

SecvenÈ›a de comenzi:
```
> AUTH admin:secret123
[OK] Authentication successful

> LIST
[OK] document.txt (1024), sample.bin (2048)

> GET document.txt
[OK] Downloaded 1024 bytes

> QUIT
```

================================================================================
SLIDE 10: Cod â€“ Header Pack
================================================================================
Titlu: Cum Ã®mpachetÄƒm header-ul

```python
import struct
import zlib

HEADER_FORMAT = '>4sIII'  # big-endian: 4s + 3 x uint32
MAGIC = b'FTPC'

def make_header(payload, compressed=False):
    crc = zlib.crc32(payload) & 0xffffffff
    flags = 1 if compressed else 0
    return struct.pack(
        HEADER_FORMAT,
        MAGIC,
        len(payload),
        crc,
        flags
    )
```

================================================================================
SLIDE 11: Cod â€“ Header Unpack
================================================================================
Titlu: Cum despachetÄƒm header-ul

```python
def parse_header(data):
    magic, length, crc, flags = struct.unpack(
        HEADER_FORMAT, 
        data[:16]
    )
    
    if magic != MAGIC:
        raise ValueError("Invalid magic bytes")
    
    return {
        'length': length,
        'crc': crc,
        'compressed': bool(flags & 1)
    }
```

================================================================================
SLIDE 12: CapturÄƒ Wireshark
================================================================================
Titlu: Capturarea Traficului

PaÈ™i:
1. PorniÈ›i captura:
```bash
tshark -i lo -f "tcp port 9021" -w capture.pcap &
```

2. GeneraÈ›i trafic (demo client-server)

3. OpriÈ›i captura:
```bash
kill %1
```

4. AnalizaÈ›i:
```bash
tshark -r capture.pcap -x | head -50
```

================================================================================
SLIDE 13: Interpretare CapturÄƒ
================================================================================
Titlu: Ce vedem Ã®n capturÄƒ

Screenshot/Exemplu hex:
```
0000  46 54 50 43 00 00 00 10 a1 b2 c3 d4 00 00 00 00
      â”‚         â”‚              â”‚              â”‚
      â””â”€ MAGIC  â””â”€ LEN=16     â””â”€ CRC        â””â”€ FLAGS
```

Filtre utile:
â€¢ `tcp.port == 9021` â€“ tot traficul
â€¢ `tcp.len > 0` â€“ doar cu payload
â€¢ `frame contains "FTPC"` â€“ pachete protocol

================================================================================
SLIDE 14: Docker Setup
================================================================================
Titlu: PregÄƒtire Docker Compose

FiÈ™ier docker-compose.yml:
```yaml
services:
  ftp-server:
    build: .
    ports: ["9021:9021"]
    
  client-1:
    build: .
    depends_on: [ftp-server]
    command: python client_test.py --tasks get
    
  client-2:
    build: .
    depends_on: [ftp-server]
    command: python client_test.py --tasks put
```

================================================================================
SLIDE 15: Docker ExecuÈ›ie
================================================================================
Titlu: Rularea Multi-Client

```bash
cd docker/
docker compose up
```

Output:
```
ftp-server  | [INFO] Listening on 0.0.0.0:9021
client-1    | [OK] Connected to ftp-server:9021
client-2    | [OK] Connected to ftp-server:9021
client-1    | [OK] GET completed
client-2    | [OK] PUT completed
```

Cleanup:
```bash
docker compose down -v
```

================================================================================
SLIDE 16: Debugging Tips
================================================================================
Titlu: Probleme Frecvente È™i SoluÈ›ii

| ProblemÄƒ | CauzÄƒ | SoluÈ›ie |
|----------|-------|---------|
| Connection refused | Server nu ruleazÄƒ | VerificÄƒ `netstat -tlnp \| grep 9021` |
| Invalid magic | Protocol mismatch | VerificÄƒ versiunea client/server |
| CRC mismatch | Date corupte | VerificÄƒ compresie on/off |
| Port in use | Container vechi | `docker compose down` |

================================================================================
SLIDE 17: ExerciÈ›ii
================================================================================
Titlu: ExerciÈ›ii pentru practicÄƒ

â­ INFO â€“ AdÄƒugaÈ›i comanda INFO
â­â­ LIST wildcard â€“ Suport pentru pattern
â­â­ MKDIR â€“ Creare directoare
â­â­â­ REST â€“ Reluare transferuri
â­â­â­ Rate limit â€“ Limitare vitezÄƒ
ğŸ† MGET/MPUT â€“ Transfer multiplu

AlegeÈ›i minimum 2 pentru bonus!

================================================================================
SLIDE 18: ExerciÈ›iu Ghidat â€“ INFO
================================================================================
Titlu: ExerciÈ›iu: Comanda INFO

CerinÈ›Äƒ: ReturneazÄƒ informaÈ›ii server

Pas 1: AdÄƒugaÈ›i Ã®n dicÈ›ionar stats:
```python
server_stats = {
    'version': '1.0.0',
    'start_time': time.time(),
    'sessions': 0
}
```

Pas 2: Handler pentru INFO:
```python
def handle_info(self):
    uptime = time.time() - server_stats['start_time']
    return f"Version: {server_stats['version']}, " \
           f"Uptime: {uptime:.0f}s"
```

================================================================================
SLIDE 19: Mininet (OpÈ›ional)
================================================================================
Titlu: Simulare cu Mininet

Topologie simplÄƒ:
```
    h1 â”€â”€â”€â”€ s1 â”€â”€â”€â”€ h2
  (server)      (client)
```

Comenzi:
```bash
sudo python topo_base.py
mininet> h1 python server.py &
mininet> h2 python client.py --host 10.0.0.1
```

AdÄƒugare latenÈ›Äƒ:
```bash
mininet> sh tc qdisc add dev s1-eth1 root netem delay 100ms
```

================================================================================
SLIDE 20: Verificare FinalÄƒ
================================================================================
Titlu: Checklist Predare

â˜ Server pornit È™i funcÈ›ional
â˜ Client executat comenzi cu succes
â˜ CapturÄƒ .pcap generatÄƒ
â˜ Docker multi-client rulat
â˜ NotÄƒ reflexivÄƒ completatÄƒ

FiÈ™iere de predat:
â€¢ pcap/session_capture.pcap
â€¢ screenshot-uri demonstraÈ›ie
â€¢ (bonus) cod exerciÈ›ii rezolvate

================================================================================
SLIDE 21: Recapitulare
================================================================================
Titlu: Ce am realizat

âœ“ Implementat protocol binar cu header structurat
âœ“ Testat client-server cu sesiuni autentificate
âœ“ Analizat trafic la nivel de bytes
âœ“ Orchestrat containere pentru test concurent

Concepte aplicate:
â€¢ Nivelul Sesiune: autentificare, stare
â€¢ Nivelul Prezentare: encoding, integritate

================================================================================
SLIDE 22: SÄƒptÄƒmÃ¢na Viitoare
================================================================================
Titlu: Preview: Seminar 10

Subiect: Servicii de reÈ›ea â€“ DNS, SSH, FTP Ã®n containere

PregÄƒtire:
â€¢ RevedeÈ›i comenzi Docker de bazÄƒ
â€¢ InstalaÈ›i OpenSSH client
â€¢ CitiÈ›i despre DNS resolution

================================================================================
SLIDE 23: Resurse
================================================================================
Titlu: Link-uri Utile

DocumentaÈ›ie:
â€¢ Python struct: docs.python.org/3/library/struct.html
â€¢ Docker Compose: docs.docker.com/compose/
â€¢ tshark man: wireshark.org/docs/man-pages/tshark.html

Starterkit:
â€¢ HTML interactiv: html_prezentari/seminar.html
â€¢ README complet: README.md

================================================================================
SLIDE 24: ÃntrebÄƒri
================================================================================
Titlu: ÃntrebÄƒri?

Imagine: PictogramÄƒ FAQ

Suport:
â€¢ Ãn timpul laboratorului: ridicaÈ›i mÃ¢na
â€¢ DupÄƒ seminar: email sau forum
â€¢ Office hours: [program]

================================================================================
SLIDE 25: Final
================================================================================
Titlu: Succes la laborator!

Subtitlu: Seminar 9 â€“ Protocoale de FiÈ™iere

Remember:
"The best way to understand a protocol is to implement one."

Footer: Â© 2025 ReÈ›ele de Calculatoare | ASE BucureÈ™ti | Revolvix&Hypotheticalandrei
