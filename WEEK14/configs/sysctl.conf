# sysctl.conf — Tunări kernel pentru testare rețea
# Starterkit Săptămâna 14 — Rețele de Calculatoare
#
# Aplicare: sudo sysctl -p configs/sysctl.conf
# Resetare: sudo sysctl --system
#
# ATENȚIE: Aceste setări sunt pentru medii de testare, nu producție!

# ============================================================================
# NETWORKING - GENERAL
# ============================================================================

# Activează forwarding IP (necesar pentru routing/NAT)
net.ipv4.ip_forward = 1

# Dezactivează verificarea strict a sursei (pentru topologii asimetrice)
net.ipv4.conf.all.rp_filter = 0
net.ipv4.conf.default.rp_filter = 0

# Răspunde la ping broadcasts (util pentru descoperire rețea în lab)
net.ipv4.icmp_echo_ignore_broadcasts = 0

# ============================================================================
# TCP TUNING
# ============================================================================

# Crește bufferele TCP pentru throughput mai bun
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# Activează TCP window scaling
net.ipv4.tcp_window_scaling = 1

# Crește coada de conexiuni (pentru servere cu load)
net.core.somaxconn = 4096
net.ipv4.tcp_max_syn_backlog = 4096

# Reduce TIME_WAIT (util în teste, nu producție!)
net.ipv4.tcp_fin_timeout = 15
net.ipv4.tcp_tw_reuse = 1

# Keepalive mai agresiv (pentru detectare rapidă de conexiuni moarte)
net.ipv4.tcp_keepalive_time = 60
net.ipv4.tcp_keepalive_intvl = 10
net.ipv4.tcp_keepalive_probes = 3

# ============================================================================
# UDP TUNING
# ============================================================================

# Crește bufferele UDP
net.core.rmem_default = 1048576
net.core.wmem_default = 1048576

# ============================================================================
# PENTRU MININET
# ============================================================================

# Permite mai multe network namespaces
# (necesar pentru topologii mari)
# kernel.unprivileged_userns_clone = 1

# Crește limita de file descriptors
fs.file-max = 2097152

# ============================================================================
# SECURITATE (relaxată pentru lab)
# ============================================================================

# Acceptă ICMP redirects (util în lab, dezactivat în producție)
net.ipv4.conf.all.accept_redirects = 1
net.ipv4.conf.default.accept_redirects = 1

# Permite bind pe adrese non-locale (pentru load balancing)
net.ipv4.ip_nonlocal_bind = 1

# ============================================================================
# END
# ============================================================================
